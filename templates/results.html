<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Processing...</title>
</head>
<body>
  <h1>Processing Your Request</h1>
  <div id="status">Please wait, this may take several minutes...</div>
  <div id="result"></div>

  <script>
    const jobId = "{{ job_id }}";
    function checkStatus() {
      fetch(`/status/${jobId}`)
        .then(response => response.json())
        .then(data => {
          document.getElementById('status').innerText = `Job Status: ${data.status}`;
          
          if (data.status === 'finished') {
            const result = data.result;
            if (result.error) {
                document.getElementById('result').innerHTML = `<p>Error: ${result.error}</p>`;
            } else if (result.zip_path) {
                // This now correctly looks for 'zip_path'
                document.getElementById('result').innerHTML = `
                  <p><strong>Processing Complete!</strong></p>
                  <p><a href="/${result.zip_path}" download><strong>Download Delivery Package (.zip)</strong></a></p>
                `;
            }
          } else if (data.status === 'failed') {
            document.getElementById('result').innerHTML = 'Job failed. Please check the terminal logs for the full error.';
          } else {
            // If not finished or failed, check again in 5 seconds
            setTimeout(checkStatus, 5000);
          }
        });
    }
    // Start checking immediately
    checkStatus();
  </script>
</body>
</html>
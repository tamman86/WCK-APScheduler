<!doctype html>
<html>
<head>
  <title>Processing...</title>
</head>
<body>
  <h1>Processing Your Request</h1>
  <div id="status">Please wait, this may take several minutes...</div>
  <div id="result"></div>
  <script>
    const jobId = "{{ job_id }}";
    function checkStatus() {
      fetch(`/status/${jobId}`)
        .then(response => response.json())
        .then(data => {
          document.getElementById('status').innerText = `Job Status: ${data.status}`;
          if (data.status === 'finished') {
            const result = data.result;
            if (result.error) {
                document.getElementById('result').innerHTML = `<p>Error: ${result.error}</p>`;
            } else {
                document.getElementById('result').innerHTML = `
                  <p><a href="/${result.excel_path}" download>Download Schedule (Excel)</a></p>
                  <p><a href="/${result.map_path}" target="_blank">View Coverage Map</a></p>
                `;
            }
          } else if (data.status === 'failed') {
            document.getElementById('result').innerText = 'Job failed. Please check the logs.';
          } else {
            // If not finished or failed, check again in 5 seconds
            setTimeout(checkStatus, 5000);
          }
        });
    }
    // Start checking immediately
    checkStatus();
  </script>
</body>
</html>